---
name: ralph-plan
description: Create a complete Ralph-ready plan with specs and implementation plan
disable-model-invocation: true
allowed-tools: AskUserQuestion, Bash, Glob, Grep, Read, Write
---

# /ralph-plan - Create a Ralph-Ready Plan

You are creating a complete Ralph Wiggum setup for an autonomous development task. This involves analyzing requirements, creating specification files, and generating an implementation plan.

## Arguments

The user provides a task description in `$ARGUMENTS`.

## Your Job

1. **Analyze the task** - Understand what needs to be done
2. **Break into specifications** - Create discrete, focused spec files
3. **Generate implementation plan** - Prioritized list of tasks
4. **Configure loop parameters** - Set appropriate limits
5. **Get user approval** - Present plan for confirmation
6. **Start the loop** - Invoke `/ralph-start` if approved

## Step 1: Task Analysis

First, study the codebase to understand:
- Current architecture and patterns
- Existing tests and validation
- Files that will be affected
- Potential blockers or risks

Use Glob and Grep to explore. Read key files for context.

## Step 2: Create Specification Files

Create a `specs/` directory with one file per topic of concern.

### Spec File Format

Each spec file should:
- Focus on ONE topic (no "and" conjunctions in filename)
- Use declarative, desired-state language
- Include testable acceptance criteria
- Be self-contained

### Spec File Template

```markdown
# [Topic Name]

## Desired State

[Describe what should be true when this spec is complete]

## Requirements

1. [Specific requirement 1]
2. [Specific requirement 2]
3. [Specific requirement 3]

## Acceptance Criteria

- [ ] [Testable criterion 1]
- [ ] [Testable criterion 2]
- [ ] [Testable criterion 3]

## Files Affected

- `path/to/file1.ts`
- `path/to/file2.ts`

## Validation

[How to verify this spec is complete - tests to run, commands to execute]
```

## Step 3: Generate Implementation Plan

Create `IMPLEMENTATION_PLAN.md` in the project root:

```markdown
# Implementation Plan

Generated by /ralph-plan on [DATE]

## Overview

[Brief description of what this plan accomplishes]

## Tasks

### Phase 1: [Phase Name]

- [ ] Task 1: [Description]
- [ ] Task 2: [Description]

### Phase 2: [Phase Name]

- [ ] Task 3: [Description]
- [ ] Task 4: [Description]

## Completion Criteria

The task is complete when:
1. [Criterion 1]
2. [Criterion 2]
3. All tests pass

## Loop Configuration

- **Max iterations:** [NUMBER]
- **Completion promise:** [STRING]
- **Key validations:**
  - [Test command 1]
  - [Test command 2]
```

## Step 4: Present Plan to User

After creating specs and plan, present a summary:

```
## Ralph Plan Ready

I've created a Ralph-ready plan for: [TASK]

### Specifications Created
- specs/[name1].md - [brief description]
- specs/[name2].md - [brief description]

### Implementation Plan
- [X] tasks across [N] phases
- Estimated max iterations: [NUMBER]
- Completion promise: "[STRING]"

### Key Validations
- [Test/check 1]
- [Test/check 2]

Would you like me to start the Ralph loop now? [Yes/No]
```

Use AskUserQuestion to get confirmation.

## Step 5: Start the Loop

If the user approves, invoke `/ralph-start` with:
- The task description
- The configured max iterations
- The completion promise

Example command to execute:
```
/ralph-start [TASK_DESCRIPTION] --max-iterations [N] --completion-promise "[PROMISE]"
```

## Guidelines

### Spec File Naming

Use lowercase with hyphens:
- `user-authentication.md` (good)
- `UserAuthentication.md` (avoid)
- `user-auth-and-session.md` (bad - has "and")

### Max Iterations Guidelines

| Task Type | Suggested Max |
|-----------|---------------|
| Small refactor (5-10 files) | 20 |
| Medium migration (10-30 files) | 40 |
| Large refactor (30+ files) | 60 |
| Complex multi-phase | 80 |

Add 20% buffer for unexpected issues.

### Completion Promise Guidelines

Make it specific and unlikely to appear accidentally:
- `JWT_AUTH_MIGRATION_COMPLETE`
- `MOMENT_TO_DATEFNS_DONE`
- `TEST_COVERAGE_GOAL_MET`

Avoid generic strings like `DONE` or `COMPLETE`.

## Example Output

For task: "Migrate from Express to Fastify"

Creates:
```
specs/
├── fastify-setup.md
├── route-migration.md
├── middleware-migration.md
├── error-handling.md
└── testing-updates.md

IMPLEMENTATION_PLAN.md
```

With configuration:
- Max iterations: 50
- Completion promise: `EXPRESS_TO_FASTIFY_COMPLETE`
- Validation: `npm test && npm run build`

Now analyze the task in `$ARGUMENTS` and create the Ralph-ready plan.
